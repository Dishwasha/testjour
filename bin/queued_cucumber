#!/usr/bin/env ruby

require File.expand_path("./vendor/plugins/cucumber/lib/cucumber")
require File.expand_path(File.dirname(__FILE__) + "/../lib/queue_server")
require File.expand_path(File.dirname(__FILE__) + "/../lib/queueing_executor")

module Cucumber
  silence_warnings do
    Executor = QueueingExecutor
  end
end

QueueServer.start

DRb.start_service
ro = DRbObject.new(nil, Testjour::DRB_URL)
ro.reset

Cucumber::CLI.execute

$executor.step_count.times do
  print ro.take_result
  $stdout.flush
end